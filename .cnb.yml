# .cnb.yml
$:
  # vscode äº‹ä»¶ï¼šä¸“ä¾›é¡µé¢ä¸­å¯åŠ¨è¿œç¨‹å¼€å‘ç”¨
  vscode:
    - runner:
        # è‡ªå®šä¹‰CPUæ ¸å¿ƒæ•°,æœ€å¤§æ”¯æŒ64æ ¸
        cpus: 64
      docker:
        # è‡ªå®šä¹‰å¼€å‘ç¯å¢ƒ
        build:
          # æŒ‡å®šæ„å»ºé•œåƒçš„ Dockerfile æ–‡ä»¶
          dockerfile: .ide/Dockerfile
      services:
        # å£°æ˜ä½¿ç”¨ vscode æœåŠ¡
        - vscode
        # å£°æ˜åœ¨å®¹å™¨ä¸­æ”¯æŒ docker å‘½ä»¤
        - docker
      stages:
        - name: ç¯å¢ƒå¯åŠ¨æ—¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤
          script:
            # å®‰è£…pnpmå¹¶ä½¿ç”¨pnpmå®‰è£…ä¾èµ–
            - npm install -g pnpm
            - pnpm i

# mainåˆ†æ”¯é…ç½®
main:
  push:
    - runner:
        cpus: 64 # è‡ªå®šä¹‰CPUæ ¸å¿ƒæ•°
      services:
        - docker ## å¯ç”¨DockeræœåŠ¡ï¼ˆç”¨äºæ„å»ºé•œåƒæˆ–å®¹å™¨åŒ–æ“ä½œï¼‰
        - git-clone-yyds # è‡ªå®šä¹‰çš„Gitå…‹éš†æœåŠ¡ï¼ˆç¡®ä¿ä»£ç èƒ½æ­£ç¡®æ‹‰å–åˆ°è¿è¡Œç¯å¢ƒï¼‰
      docker:
        image: docker.cnb.cool/znb/images/node:18 # ä½¿ç”¨Node.js 18ç‰ˆæœ¬çš„é•œåƒï¼ˆå‰ç«¯é¡¹ç›®å¸¸ç”¨ç¯å¢ƒï¼‰
        volumes: # æ•°æ®å·æŒ‚è½½
          - /data/.cache:copy-on-write # å°†å®¿ä¸»æœºçš„/data/.cacheç›®å½•æŒ‚è½½åˆ°å®¹å™¨ï¼Œé‡‡ç”¨"å†™æ—¶å¤åˆ¶"æ¨¡å¼ï¼ˆé«˜æ•ˆç¼“å­˜ä¾èµ–ï¼ŒåŠ é€Ÿæ„å»ºï¼‰
      stages:
        - name: ğŸ–¨ï¸ æ‰“å°ç¯å¢ƒ
          script: |
            node -v && npm -v && yarn -v && pnpm -v
        - name: ğŸ“¦ï¸ å®‰è£…ä¾èµ–
          script: |
            pnpm install
        - name: âš—ï¸ ç¼–è¯‘é¡¹ç›®
          script: |
            pnpm docs:build   # VitePress ä¸“ç”¨å‘½ä»¤
        - name: ğŸšš å‘å¸ƒåˆ¶å“
          image: tencentcom/rsync # ä½¿ç”¨åŒ…å«rsyncå·¥å…·çš„é•œåƒï¼ˆrsyncç”¨äºé«˜æ•ˆæ–‡ä»¶åŒæ­¥ï¼‰
          imports: https://cnb.cool/W3C/Hyde/teek-hyde/-/blob/main/env.yaml # å¯¼å…¥å¤–éƒ¨ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ï¼Œå®é™…æ›¿æ¢è‡ªå·±çš„
          settings:
            user: ${SSH_USER} # SSHç”¨æˆ·åï¼ˆä»ç¯å¢ƒå˜é‡è·å–ï¼Œé¿å…ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯ï¼‰
            key: ${SSH_KEY} # SSHç§é’¥ï¼ˆç”¨äºå…å¯†ç™»å½•ç›®æ ‡æœåŠ¡å™¨ï¼Œä»ç¯å¢ƒå˜é‡è·å–ï¼‰
            port: 22 # SSHç«¯å£ï¼ˆé»˜è®¤22ï¼‰
            hosts:
              - 111.229.208.160 # ç›®æ ‡æœåŠ¡å™¨IPï¼ˆè¦éƒ¨ç½²åˆ°çš„æœåŠ¡å™¨åœ°å€ï¼Œå®é™…æ›¿æ¢è‡ªå·±çš„æœåŠ¡å™¨IPï¼‰
            source: docs/.vitepress/dist/ # å¾…åŒæ­¥çš„æœ¬åœ°æ–‡ä»¶ç›®å½•ï¼ˆé˜¶æ®µ3æ„å»ºå‡ºçš„é™æ€æ–‡ä»¶ï¼‰
            target: /root/rsync/teek.seasir.top/dist/ # ç›®æ ‡æœåŠ¡å™¨ä¸Šçš„å­˜æ”¾è·¯å¾„
            delete: true # åŒæ­¥æ—¶åˆ é™¤ç›®æ ‡è·¯å¾„ä¸­ä¸å­˜åœ¨çš„æ–‡ä»¶ï¼ˆç¡®ä¿ç›®æ ‡ä¸æœ¬åœ°å®Œå…¨ä¸€è‡´ï¼Œé¿å…å†—ä½™æ–‡ä»¶ï¼‰

# masteråˆ†æ”¯é…ç½®ï¼ˆäº‘åŸç”Ÿæ„å»ºæµç¨‹å’Œè‡ªåŠ¨éƒ¨ç½²ï¼‰
master:
  push:
    - imports: https://cnb.cool/W3C/Hyde/APIToken/-/blob/main/APIToken.yml
      stages:
        - name: æ„å»ºå½“å‰é¡¹ç›®
          image: node:22
          script: npm install -g pnpm && pnpm i && pnpm run docs:build
        - name: éƒ¨ç½²åˆ°Pages
          image: node:22
          script: npx edgeone pages deploy ./docs/.vitepress/dist --name vitepress-theme-teek --token $EDGEONE_PAGES_API_TOKEN